<a href="../../code#ifm2025" target="_self" style="float: left;"> retour Ã  Code </a>
<a href="https://cffdrs.github.io/website_en/code/FWI2025_C" target="_self" style="float: right;"> English </a>

<h3 style="text-align: center; font-style: italic;"> Traduction en cours </h3>

<br>

# FWI2025 - C

*Last updated: December 10th, 2025*

## C Scripts
There are six scripts on the [cffdrs-ng GitHub repository](https://github.com/nrcan-cfs-fire/cffdrs-ng) that are required to generate FWI2025 outputs:

1. [**NG_FWI_main.c**](https://github.com/nrcan-cfs-fire/cffdrs-ng/blob/main/FWI/C/NG_FWI_main.c) holds the `main()` function that handles the command line input parameters and output.

1. [**NG_FWI.c**](https://github.com/nrcan-cfs-fire/cffdrs-ng/blob/main/FWI/C/NG_FWI.c) holds the functions and equations for generating FWI2025 outputs.

3. [**NG_FWI.h**](https://github.com/nrcan-cfs-fire/cffdrs-ng/blob/main/FWI/C/NG_FWI.h) header file for **NG_FWI.c**.

2. [**util.c**](https://github.com/nrcan-cfs-fire/cffdrs-ng/blob/main/FWI/C/util.c) includes basic functions that are not part of FWI2025 equations, but generate intermediate information for the calculation of the FWI2025 components (e.g. time of sunrise and sunset, number of sunlight hours).

5. [**util.h**](https://github.com/nrcan-cfs-fire/cffdrs-ng/blob/main/FWI/C/util.h) header file for **util.c**.

3. [**daily_summaries.c**](https://github.com/nrcan-cfs-fire/cffdrs-ng/blob/main/FWI/C/daily_summaries.c) holds the functions to generate the daily summary report.

## Headers
The FWI2025 C scripts use the following header files from the C standard library.

- [`<math.h>`](https://en.cppreference.com/w/c/header/math)
- [`<stdarg.h>`](https://en.cppreference.com/w/c/header/stdarg)
- [`<stdbool.h>`](https://en.cppreference.com/w/c/header/stdbool)
- [`<stdio.h>`](https://en.cppreference.com/w/c/header/stdio)
- [`<stdlib.h>`](https://en.cppreference.com/w/c/header/stdlib)
- [`<string.h>`](https://en.cppreference.com/w/c/header/string)
- [`<time.h>`](https://en.cppreference.com/w/c/header/time)

## Get Started
The GitHub repository also includes a [tutorial script] and [C-formatted test data]. See [Tutorials#Hourly FWI] for a step-by-step workflow with hourly data. The documentation below goes into details about specific functions and data requirements.

## Data Format
FWI2025 code is written for and tested using input data in the form of a table/array, commonly imported as comma-separated values (CSV) file. Each row then corresponds with a single timestep (i.e. hour), in sequential order. Outputs are then also of the same table/array form, with additional columns.

In C, the code is built to be compiled and then run in a command-line interface only. Users can configure the input file type before and output file type after calculation to fit individual data streams.

**NOTE: The C version can only handle one station for one continuous season at a time!** See the [Python] or [R] versions to be able to run multiple stations with multiple years at once.

## Hourly FWI
To calculate hourly FWI moisture codes and fire behaviour indices, the scripts to compile are:

- **NG_FWI_main.c**
- **NG_FWI.c**
- **util.c**

For example, using [`gcc`](https://gcc.gnu.org/) in PowerShell:

```ps
gcc -o NG_FWI NG_FWI_main.c NG_FWI.c util.c
```

produces a **NG_FWI.exe** executable file.

### Input DataFrame
The FWI system was originally designed to be calculated using data recorded at local weather stations, but any collected or calculated data (e.g. gridded data, forecast data, etc.) that includes the required weather variables can be used. See the [CFFDRS Weather Guide](https://ostrnrcan-dostrncan.canada.ca/handle/1845/219568) for a description of weather data standards for the FWI System.

The table below describes the columns and units for the input CSV file. Columns are required unless there is a default, in which case they will be set or calculated. At this time for C, **column names must be lower-case**, and output columns are always lower-case.

| Column | Description | Units | Type |
| --- | --- | :-: | :-: |
| `lat` | Latitude | DD | float |
| `long` | Longitude | DD | float |
| `yr` | Year of data point | | int |
| `mon` | Month of the year (1-12) | | int |
| `day` | Day of the month (1-31) | | int |
| `hr` | Hour of the day (0-23) | | int |
| `temp` | Air temperature | Â°C | float |
| `rh` | Relative humidity (0-100) | % | float |
| `ws` | 10 m open wind speed | km/hr | float |
| `prec` | Hourly precipitation | mm | float |
| `grass_fuel_load` | Density of grassland fuels (default 0.35) | kg/m^2 | float |
| `percent_cured` | Fraction of grassland fuels that is cured (0-100, default based on annual variation in the Boreal Plains region) | % | float |
| `solrad` | [Solar radiation](../documents/MCEDIF2025_rayonnement-solaire-IFM.pdf)ðŸ“¥ (default an estimation based on other required variables) | kW/m^2 | float |

### Parameters
The required parameters in the command line are input data file location/name, output file location/name, and timezone. All other parameters have a default startup value if not specified (denoted with square brackets). Since they are ordered, if you want to specify a single optional parameter, you will need to provide defaults to all prior parameters as well.

```ps
./NG_FWI.exe input output timezone [ffmc_old] [mcffmc_old] [dmc_old] [dc_old]
    [mcgfmc_matted_old] [mcgfmc_standing_old] [prec_cumulative] [canopy_drying]
```

| No. | Parameter | Description |
| :-: | --- | --- |
| 1 | `input` | Location and name of CSV file of hourly weather stream (see <a href="#input-dataframe" target="_self">Input DataFrame</a> section above) |
| 2 | `output` | Location and name for hourly FWI CSV file |
| 3 | `timezone` | UTC offset. There is no option currently to use a `timezone` column in input data like in Python and R. |
| 4 | `ffmc_old` | Previous value for FFMC (default 85). Set to "n" if `mcffmc_old` is specified instead |
| 5 | `mcffmc_old` | Previous value for mcffmc. Set to "n" if `ffmc_old` is specified instead |
| 6 | `dmc_old` | Previous value for DMC (default 6) |
| 7 | `dc_old` | Previous value for DC (default 15) |
| 8 | `mcgfmc_matted_old` | Previous value for mcgfmc_matted (default 16.31) |
| 9 | `mcgfmc_standing_old` | Previous value for mcgfmc_standing (default 16.31) |
| 10 | `prec_cumulative` | Cumulative precipitation this rainfall (default 0) |
| 11 | `canopy_drying` | Consecutive hours of no precipitation (default 0). 5 hours or more resets to 0 |

### Output
The result of **NG_FWI.exe** is the input CSV file with additional output columns. The order is preserved with the exception of a `timezone` column after `long` and before `yr`. See below for the other output columns.

| Column | Description |
| --- | --- |
| `grass_fuel_load` | Density of grassland fuels (if not provided) |
| `percent_cured` | Fraction of cured grassland fuels (if not provided) |
| `solrad` | Solar radiation (if not provided) |
| `sunrise` | Hour of sunrise |
| `sunset` | Hour of sunset |
| `sunlight_hours` | Number of hours between sunrise and sunset |
| `mcffmc` | Fine fuel moisture content |
| `ffmc` | Fine Fuel Moisture Code |
| `dmc` | Duff Moisture Code |
| `dc` | Drought Code |
| `isi` | Initial Spread Index |
| `bui` | Buildup Index |
| `fwi` | Fire Weather Index |
| `dsr` | Daily Severity Rating |
| `mcgfmc_matted` | Matted grassland fuel moisture content |
| `mcgfmc_standing` | Standing grassland fuel moisture content |
| `gfmc` | Grassland Fuel Moisture Code |
| `gsi` | Grassland Spread Index |
| `gfwi` | Grassland Fire Weather Index |
| `prec_cumulative` | Cumulative precipitation this rainfall |
| `canopy_drying` | Consecutive hours of no precipitation. 5 hours or more resets to 0 |

## Daily Summaries
Hourly FWI components can be summarized in a variety of ways depending on usage and requirements. One way is to create a daily report, the default method of which can be run by compiling the following scripts:

- **daily_summaries.c**
- **NG_FWI.c**
- **util.c**

```ps
gcc -o daily_summaries daily_summaries.c NG_FWI.c util.c
```

**daily_summaries.exe** boils down the hourly data into daily metrics, which means every row in the output now represents a day.

### Parameters

The only required parameters are input and output file location/name. The optional `reset_hr` parameter deals with how to align more accurately with the typical daily fire behaviour cycle. By default, we use 05:00 (12 hours opposite 17:00), which means the 24 hours summarized are between 05:00 of the listed day and 04:00 of the next day (instead of 00:00 to 23:00). The first or last days are left out if they are represented by 12 or fewer hours of data.

```ps
./daily_summaries.exe input ouput [reset_hr]
```

| Parameter | Description |
| --- | --- |
| `input` | Location and name of hourly FWI CSV file generated by **NG_FWI.exe** (see <a href="#hourly-fwi" target="_self">Hourly FWI</a> section above) |
| `output` | Location and name for daily summaries report CSV file |
| `reset_hr` | The boundary between days, instead of midnight (default 5) |

### Output

| Parameter | Description |
| --- | --- |
| `yr` | Year |
| `mon` | Month of year |
| `day` | Day of month |
| `sunrise` | Hour of sunrise |
| `sunset` | Hour of sunset |
| `peak_hr` | Expected hour of daily maximum fire behaviour. Set as the hour of maximum ISI calculated using a smoothed wind speed (see `ws_smooth`), or 17:00 if daily maximum FFMC is less than 85 |
| `duration` | Expected number of hours in the daily burning window. Calculated as the number of hours (possibly discontinuous) where `isi_smooth` is greater than 5 |
| `ffmc` | Fine Fuel Moisture Code at `peak_hr` |
| `dmc` | Duff Moisture Code at `peak_hr` |
| `dc` | Drought Code at `peak_hr` |
| `isi` | Initial Spread Index at `peak_hr` |
| `bui` | Buildup Index at `peak_hr` |
| `fwi` | Fire Weather Index at `peak_hr` |
| `dsr` | Daily Severity Rating at `peak_hr` |
| `gfmc` | Grassland Fuel Moisture Code at `peak_hr` |
| `gsi` | Grassland Spread Index at `peak_hr` |
| `gfwi` | Grassland Fire Weather Index at `peak_hr` |
| `ws_smooth` | Smoothed 10 m open wind speed at `peak_hr`. Smoothing calculated as every 24 hours being passed through a [1,4,6,4,1] binomial filter |
| `isi_smooth` | ISI calculated using a smoothed wind speed at `peak_hr` |
| `gsi_smooth` | GSI calculated using a smoothed wind speed at `peak_hr` |
